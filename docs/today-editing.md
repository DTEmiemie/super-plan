# /today 可编辑表格：输入行为与纯输入模式

本文档记录 /today 页面“开始/期望（min）”两列的输入交互、提交时机与测试注意事项。

## 交互与提交时机

- 单元格点击即聚焦：点击“开始/期望（min）”任意空白处，会自动聚焦到对应输入，并把光标移到末尾。
- 纯输入模式（默认）：
  - 编辑期间采用“非受控输入”（defaultValue），你键入的字符会立即显示，不受受控渲染覆盖；
  - 失焦（blur）时一次性提交到 working，并清理草稿（返回受控显示）。
- 宽松时间解析（开始）：
  - 支持 2 → 02:00，930/0930 → 09:30，9:3 → 09:03，23: → 23:00；
  - 支持全角到半角归一化（数字与冒号）。建议使用半角“:”。
- 数字输入（期望）：
  - 键入数字期间立即显示；失焦后写回 desiredMin；空值或非数字解析为 0。

## 防干扰与稳定性

- 屏蔽全局热键：输入聚焦时，在捕获阶段拦截 window 的 keydown 冒泡（不阻止默认），避免拖拽/快捷键吞键；失焦自动移除。
- 仅保留指针拖拽：移除了 dnd-kit 的 KeyboardSensor，避免文档级键盘监听影响输入。
- 行级快捷键：在编辑/纯输入状态下短路（不响应 Alt+↑/↓ 等）。

## 常见问题

- 看起来“打不进去”：
  - 确认点击的是“开始/期望”单元格（而非行内“⋯ 操作”按钮）；
  - 顶部“🔧 输入框调试面板”显示“编辑状态: true”，且“固定草稿/分钟草稿”随着键入在变化；
  - 输入法与浏览器扩展可能会拦截 beforeinput，请先尝试禁用相应扩展验证。
- 输入后未生效：
  - 纯输入模式下需失焦（点击空白/切换格）后才提交；
  - 开始值会被归一化为 HH:mm 格式（不合法输入会被忽略）。

## 自动化测试注意事项

- 定位：
  - 开始：`input[data-testid^="tdy-start-"]`
  - 期望：`input[data-testid^="tdy-min-"]`
- 推荐序列：focus → 触发 input/change → blur → 断言受控显示/行联动。
- 若仅通过 fill/type，确保触发 input 事件；纯输入模式下字符会立即可见。

