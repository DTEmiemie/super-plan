# ä¿®å¤"å¼€å§‹"åˆ—æ— æ³•è¿ç»­è¾“å…¥é—®é¢˜

## é—®é¢˜æè¿°

**ç°è±¡**ï¼šåœ¨ä»Šæ—¥æ‰§è¡Œ (`/today`) å’Œæ¨¡æ¿ç¼–è¾‘ (`/templates`) é¡µé¢ä¸­ï¼Œ"å¼€å§‹"åˆ—çš„è¾“å…¥æ¡†æ— æ³•è¿ç»­è¾“å…¥å’Œè¿ç»­åˆ é™¤å­—ç¬¦ï¼Œæ¯è¾“å…¥ä¸€ä¸ªå­—ç¬¦åè¾“å…¥æ¡†å°±å¤±å»å“åº”ã€‚

**å½±å“èŒƒå›´**ï¼š
- `src/app/today/page.tsx` - ä»Šæ—¥æ‰§è¡Œé¡µé¢çš„"å¼€å§‹"åˆ—è¾“å…¥æ¡†
- `src/app/templates/page.tsx` - æ¨¡æ¿ç¼–è¾‘é¡µé¢çš„"å¼€å§‹ï¼ˆé¢„ä¼°ï¼‰"åˆ—è¾“å…¥æ¡†

## æ ¹æœ¬åŸå› åˆ†æ

### 1. å—æ§ç»„ä»¶çš„å¼‚æ­¥é—®é¢˜

**åŸå§‹å®ç°**ï¼ˆé”™è¯¯ï¼‰ï¼š
```tsx
const [fixedDraft, setFixedDraft] = useState<Record<string, string>>({});

<input
  value={fixedDraft[s.id] !== undefined ? fixedDraft[s.id] : (s.fixedStart ?? '')}
  onChange={(e) => {
    const v = e.target.value;
    setFixedDraft(prev => ({ ...prev, [s.id]: v }));
  }}
/>
```

**é—®é¢˜ç‚¹**ï¼š
1. **å—æ§ç»„ä»¶**ï¼š`value` å±æ€§ç”± React state æ§åˆ¶
2. **å¼‚æ­¥æ›´æ–°**ï¼š`setState` æ˜¯å¼‚æ­¥çš„ï¼ŒçŠ¶æ€æ›´æ–°å­˜åœ¨å»¶è¿Ÿ
3. **æ¸²æŸ“å¹²æ‰°**ï¼šæ¯æ¬¡è¾“å…¥è§¦å‘ `onChange` â†’ `setState` â†’ ç»„ä»¶é‡æ–°æ¸²æŸ“
4. **å€¼å›é€€**ï¼šé‡æ–°æ¸²æŸ“æ—¶ï¼Œ`value` å¯èƒ½è¿˜æ˜¯æ—§å€¼ï¼Œå¯¼è‡´è¾“å…¥è¢«"åƒæ‰"
5. **ç„¦ç‚¹ä¸¢å¤±**ï¼šé¢‘ç¹çš„é‡æ–°æ¸²æŸ“å¯èƒ½å¯¼è‡´ DOM èŠ‚ç‚¹é‡æ–°åˆ›å»ºï¼Œè¾“å…¥æ¡†å¤±å»ç„¦ç‚¹

### 2. çº§è”æ¸²æŸ“é—®é¢˜

```tsx
function updateSlot(id: string, patch: Partial<TemplateSlot>) {
  setWorking((w) => ({
    ...w,
    slots: w.slots.map((s) => (s.id === id ? { ...s, ...patch } : s)),
  }));
}
```

æ¯æ¬¡ `updateSlot` è§¦å‘ï¼š
- `working` çŠ¶æ€æ›´æ–°
- æ•´ä¸ªé¡µé¢ç»„ä»¶é‡æ–°æ¸²æŸ“
- `schedule = computeSchedule({ template: working })` é‡æ–°è®¡ç®—
- æ‰€æœ‰ `Row` ç»„ä»¶é‡æ–°æ¸²æŸ“
- è¾“å…¥æ¡† DOM å¯èƒ½è¢«é‡æ–°åˆ›å»º

## è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒæ€è·¯ï¼šæ”¹ç”¨éå—æ§ç»„ä»¶

**æ–°å®ç°**ï¼ˆæ­£ç¡®ï¼‰ï¼š
```tsx
<input
  type="text"
  key={`${s.id}-${s.fixedStart ?? ''}`}  // âœ“ ç¡®ä¿å€¼å˜åŒ–æ—¶é‡æ–°æŒ‚è½½
  defaultValue={s.fixedStart ?? ''}       // âœ“ éå—æ§ï¼šæµè§ˆå™¨åŸç”Ÿç®¡ç†è¾“å…¥
  onFocus={() => {
    setEditing(true);  // åªè®¾ç½®ç¼–è¾‘çŠ¶æ€æ ‡å¿—
  }}
  onBlur={(e) => {
    const raw = (e.target as HTMLInputElement).value;  // âœ“ ç›´æ¥ä» DOM è¯»å–
    setEditing(false);

    // å¤±ç„¦æ—¶ä¸€æ¬¡æ€§æäº¤
    if (raw == null || raw === '') {
      updateSlot(s.id, { fixedStart: undefined });
    } else {
      const norm = parseHmLoose(raw);
      if (norm) {
        updateSlot(s.id, { fixedStart: norm });
      }
    }
  }}
/>
```

### å…³é”®æ”¹è¿›ç‚¹

#### 1. éå—æ§ç»„ä»¶ (`defaultValue`)
- **æµè§ˆå™¨åŸç”Ÿç®¡ç†**ï¼šè¾“å…¥å€¼ç”±æµè§ˆå™¨ DOM ç›´æ¥ç®¡ç†ï¼Œä¸ä¾èµ– React state
- **é›¶å»¶è¿Ÿ**ï¼šè¾“å…¥è¿‡ç¨‹ä¸­æ²¡æœ‰ä»»ä½• React çŠ¶æ€æ›´æ–°ï¼Œå®Œå…¨æµç•…
- **æ— æ¸²æŸ“å¹²æ‰°**ï¼šè¾“å…¥è¿‡ç¨‹ä¸­ä¸è§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“

#### 2. `key` å±æ€§å¼ºåˆ¶é‡æ–°æŒ‚è½½
```tsx
key={`${s.id}-${s.fixedStart ?? ''}`}
```
- å½“ `fixedStart` å€¼å˜åŒ–æ—¶ï¼Œ`key` å˜åŒ–
- React ä¼šé”€æ¯æ—§è¾“å…¥æ¡†ï¼Œåˆ›å»ºæ–°è¾“å…¥æ¡†
- æ–°è¾“å…¥æ¡†çš„ `defaultValue` ä¼šæ˜¾ç¤ºæ›´æ–°åçš„å€¼
- ä¿è¯æ•°æ®å’Œè§†å›¾çš„åŒæ­¥

#### 3. å¤±ç„¦æ—¶æäº¤
- **è¾“å…¥è¿‡ç¨‹**ï¼šå®Œå…¨ä¸è°ƒç”¨ `updateSlot`ï¼Œä¸è§¦å‘æ¸²æŸ“
- **å¤±ç„¦æ—¶åˆ»**ï¼šä» `e.target.value` ç›´æ¥è¯»å– DOM å€¼ï¼Œå‡†ç¡®æ— è¯¯
- **ä¸€æ¬¡æ€§æäº¤**ï¼šåªåœ¨å¤±ç„¦æ—¶æ›´æ–°ä¸€æ¬¡ `working` çŠ¶æ€

#### 4. ç§»é™¤è‰ç¨¿çŠ¶æ€ç®¡ç†
- **ä¹‹å‰**ï¼šéœ€è¦ `fixedDraft` çŠ¶æ€æ¥ä¸´æ—¶å­˜å‚¨è¾“å…¥å€¼
- **ç°åœ¨**ï¼šå®Œå…¨ä¸éœ€è¦ï¼Œæµè§ˆå™¨è‡ªå·±ç®¡ç†
- **æ›´ç®€æ´**ï¼šç¬¦åˆ KISS åŸåˆ™ï¼ˆKeep It Simple, Stupidï¼‰

## ä»£ç å˜æ›´å¯¹æ¯”

### today/page.tsx

**ç§»é™¤çš„ä»£ç **ï¼š
```tsx
// âŒ ä¸å†éœ€è¦è‰ç¨¿çŠ¶æ€
const [fixedDraft, setFixedDraft] = useState<Record<string, string>>({});

// âŒ ä¸å†éœ€è¦ onChange æ›´æ–°è‰ç¨¿
onChange={(e) => {
  const v = e.target.value;
  setFixedDraft(prev => ({ ...prev, [s.id]: v }));
}}

// âŒ ä¸å†éœ€è¦ onInput
onInput={(e) => {
  const v = (e.target as HTMLInputElement).value;
  setFixedDraft(prev => ({ ...prev, [s.id]: v }));
}}
```

**æ–°å¢çš„ä»£ç **ï¼š
```tsx
// âœ“ ä½¿ç”¨ defaultValue + key
<input
  key={`${s.id}-${s.fixedStart ?? ''}`}
  defaultValue={s.fixedStart ?? ''}
  onBlur={(e) => {
    const raw = (e.target as HTMLInputElement).value;
    // ... æäº¤é€»è¾‘
  }}
/>
```

### templates/page.tsx

åº”ç”¨ç›¸åŒçš„ä¿®å¤é€»è¾‘ï¼Œä¿æŒä¸¤ä¸ªé¡µé¢è¡Œä¸ºä¸€è‡´ã€‚

## æŠ€æœ¯åŸç†

### å—æ§ç»„ä»¶ vs éå—æ§ç»„ä»¶

| ç‰¹æ€§ | å—æ§ç»„ä»¶ | éå—æ§ç»„ä»¶ |
|------|----------|------------|
| å€¼ç®¡ç† | React state (`value`) | æµè§ˆå™¨ DOM (`defaultValue`) |
| æ›´æ–°æ–¹å¼ | `onChange` + `setState` | æµè§ˆå™¨åŸç”Ÿè¾“å…¥ |
| æ¸²æŸ“é¢‘ç‡ | æ¯æ¬¡è¾“å…¥è§¦å‘æ¸²æŸ“ | è¾“å…¥è¿‡ç¨‹é›¶æ¸²æŸ“ |
| æ€§èƒ½ | è¾ƒå·®ï¼ˆé¢‘ç¹æ¸²æŸ“ï¼‰ | ä¼˜ç§€ï¼ˆé›¶æ¸²æŸ“ï¼‰ |
| è¯»å–æ–¹å¼ | ä» state è¯»å– | ä» DOM è¯»å– |
| é€‚ç”¨åœºæ™¯ | éœ€è¦å®æ—¶éªŒè¯/æ ¼å¼åŒ– | ç®€å•è¾“å…¥ï¼Œå¤±ç„¦æ—¶æäº¤ |

### React çš„ key å±æ€§

```tsx
key={`${s.id}-${s.fixedStart ?? ''}`}
```

**ä½œç”¨**ï¼š
1. React é€šè¿‡ `key` è¯†åˆ«ç»„ä»¶èº«ä»½
2. `key` å˜åŒ– â†’ React è®¤ä¸ºæ˜¯ä¸åŒç»„ä»¶
3. é”€æ¯æ—§ç»„ä»¶ï¼Œåˆ›å»ºæ–°ç»„ä»¶
4. æ–°ç»„ä»¶çš„ `defaultValue` ä¼šåæ˜ æ–°å€¼

**ä¸ºä»€ä¹ˆéœ€è¦**ï¼š
- éå—æ§ç»„ä»¶çš„ `defaultValue` åªåœ¨**é¦–æ¬¡æŒ‚è½½æ—¶**ç”Ÿæ•ˆ
- åç»­æ›´æ–° `defaultValue` ä¸ä¼šæ”¹å˜è¾“å…¥æ¡†æ˜¾ç¤ºå€¼
- é€šè¿‡æ”¹å˜ `key` å¼ºåˆ¶é‡æ–°æŒ‚è½½ï¼Œå®ç°å€¼æ›´æ–°

## éªŒè¯æ–¹æ³•

### æ‰‹åŠ¨æµ‹è¯•
1. æ‰“å¼€ä»Šæ—¥æ‰§è¡Œé¡µé¢ (`/today`)
2. ç‚¹å‡»ä»»æ„ä¸€è¡Œçš„"å¼€å§‹"åˆ—è¾“å…¥æ¡†
3. å°è¯•è¿ç»­è¾“å…¥ï¼š`0830` â†’ åº”è¯¥èƒ½æµç•…è¾“å…¥æ‰€æœ‰å­—ç¬¦
4. å°è¯•è¿ç»­åˆ é™¤ï¼šæŒ‰ Backspace åˆ é™¤æ‰€æœ‰å­—ç¬¦ â†’ åº”è¯¥èƒ½æµç•…åˆ é™¤
5. å¤±ç„¦åæ£€æŸ¥ï¼šå€¼åº”è¯¥è¢«è§„èŒƒåŒ–ä¸º `08:30`
6. ç‚¹å‡»ä¸‹ä¸€è¡Œçš„"å¼€å§‹"åˆ—ï¼Œé‡å¤æµ‹è¯•

### è‡ªåŠ¨åŒ–æµ‹è¯•
```tsx
// ç¤ºä¾‹æµ‹è¯•ç”¨ä¾‹
test('å¼€å§‹åˆ—è¾“å…¥æ¡†æ”¯æŒè¿ç»­è¾“å…¥', async () => {
  const input = screen.getByTestId('tdy-start-slot-1');

  await userEvent.click(input);
  await userEvent.type(input, '0830');

  expect(input).toHaveValue('0830');

  await userEvent.tab(); // å¤±ç„¦

  expect(input).toHaveValue('08:30'); // è§„èŒƒåŒ–åçš„å€¼
});
```

## æ€§èƒ½ä¼˜åŒ–æ•ˆæœ

### ä¹‹å‰ï¼ˆå—æ§ç»„ä»¶ï¼‰
- è¾“å…¥ "0830" éœ€è¦ 4 æ¬¡æ¸²æŸ“
- æ¯æ¬¡æ¸²æŸ“éƒ½é‡æ–°è®¡ç®— `schedule`
- å¯èƒ½å¯¼è‡´è¾“å…¥å¡é¡¿ã€ä¸¢å­—

### ç°åœ¨ï¼ˆéå—æ§ç»„ä»¶ï¼‰
- è¾“å…¥ "0830" é›¶æ¸²æŸ“
- å¤±ç„¦æ—¶æ‰è§¦å‘ 1 æ¬¡æ¸²æŸ“
- è¾“å…¥ä½“éªŒä¸èˆ¬é¡ºæ»‘

## éµå¾ªçš„è®¾è®¡åŸåˆ™

1. **KISS (Keep It Simple, Stupid)**
   - ç§»é™¤äº†å¤æ‚çš„ `fixedDraft` çŠ¶æ€ç®¡ç†
   - ç›´æ¥ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿèƒ½åŠ›

2. **YAGNI (You Aren't Gonna Need It)**
   - ç§»é™¤äº†ä¸å¿…è¦çš„ `onChange`ã€`onInput` å¤„ç†
   - åªä¿ç•™å¿…éœ€çš„ `onFocus` å’Œ `onBlur`

3. **DRY (Don't Repeat Yourself)**
   - åŒæ—¶ä¿®å¤äº† Today å’Œ Templates é¡µé¢
   - ç»Ÿä¸€ä½¿ç”¨ç›¸åŒçš„éå—æ§ç»„ä»¶æ¨¡å¼

4. **æ€§èƒ½ä¼˜å…ˆ**
   - è¾“å…¥è¿‡ç¨‹é›¶æ¸²æŸ“ï¼Œæè‡´æ€§èƒ½
   - ç”¨æˆ·ä½“éªŒæ˜¾è‘—æå‡

## ç›¸å…³æ–‡ä»¶

- `src/app/today/page.tsx` - ä»Šæ—¥æ‰§è¡Œé¡µé¢ï¼ˆä¸»è¦ä¿®æ”¹ï¼šç¬¬189-242è¡Œï¼‰
- `src/app/templates/page.tsx` - æ¨¡æ¿ç¼–è¾‘é¡µé¢ï¼ˆä¸»è¦ä¿®æ”¹ï¼šç¬¬154-192è¡Œï¼‰
- `docs/today-editing.md` - åŸæœ‰è¾“å…¥è¡Œä¸ºæ–‡æ¡£ï¼ˆéœ€è¦æ›´æ–°ï¼‰

## åç»­æ”¹è¿›å»ºè®®

1. **æ›´æ–°ç°æœ‰æ–‡æ¡£**ï¼šä¿®æ”¹ `docs/today-editing.md`ï¼Œè¯´æ˜å·²æ”¹ç”¨éå—æ§ç»„ä»¶
2. **ç»Ÿä¸€å…¶ä»–è¾“å…¥æ¡†**ï¼šè€ƒè™‘å°†"æœŸæœ›ï¼ˆminï¼‰"åˆ—ä¹Ÿæ”¹ä¸ºéå—æ§ç»„ä»¶ï¼Œä¿æŒä¸€è‡´æ€§
3. **æ·»åŠ å•å…ƒæµ‹è¯•**ï¼šä¸ºè¿ç»­è¾“å…¥åœºæ™¯æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯•
4. **æ€§èƒ½ç›‘æ§**ï¼šéªŒè¯æ¸²æŸ“æ¬¡æ•°æ˜¯å¦çœŸçš„å‡å°‘äº†

## æ€»ç»“

é€šè¿‡å°†"å¼€å§‹"åˆ—è¾“å…¥æ¡†ä»**å—æ§ç»„ä»¶æ”¹ä¸ºéå—æ§ç»„ä»¶**ï¼Œå½»åº•è§£å†³äº†æ— æ³•è¿ç»­è¾“å…¥çš„é—®é¢˜ã€‚æ ¸å¿ƒæ€è·¯æ˜¯ï¼š
1. ä½¿ç”¨ `defaultValue` è®©æµè§ˆå™¨ç®¡ç†è¾“å…¥å€¼
2. ä½¿ç”¨ `key` ç¡®ä¿å€¼å˜åŒ–æ—¶é‡æ–°æŒ‚è½½
3. å¤±ç„¦æ—¶ä» DOM ç›´æ¥è¯»å–å¹¶æäº¤

è¿™ä¸ªä¿®å¤ä¸ä»…è§£å†³äº†é—®é¢˜ï¼Œè¿˜æ˜¾è‘—æå‡äº†æ€§èƒ½å’Œä»£ç ç®€æ´æ€§ï¼Œå®Œç¾ä½“ç°äº† React å—æ§ vs éå—æ§ç»„ä»¶çš„æƒè¡¡å–èˆã€‚

---

## CI æµ‹è¯•ç¯å¢ƒä¿®å¤

### é—®é¢˜æè¿°

åœ¨ä¿®å¤è¾“å…¥æ¡†é—®é¢˜å¹¶æ¨é€åï¼ŒCI æŒç»­å¤±è´¥ï¼ŒæŠ¥é”™ï¼š

```
TypeError: Cannot read properties of undefined (reading 'get')
â¯ Object.<anonymous> node_modules/webidl-conversions/lib/index.js:325:94
â¯ Object.<anonymous> node_modules/whatwg-url/lib/URL.js:3:21

Vitest caught 5 unhandled errors during the test run.
```

### æ ¹æœ¬åŸå› åˆ†æ

1. **jsdom çš„ polyfill ä¾èµ–**
   - jsdom åœ¨ Node.js ç¯å¢ƒä¸­éœ€è¦æ‰‹åŠ¨ polyfillsï¼ˆTextEncoderã€TextDecoderã€crypto ç­‰ Web APIsï¼‰
   - è¿™äº› API åœ¨æµè§ˆå™¨ä¸­åŸç”Ÿæ”¯æŒï¼Œä½†åœ¨ Node.js ä¸­ä¸å­˜åœ¨

2. **Polyfill æ—¶åºé—®é¢˜**
   - åˆ›å»ºäº† `vitest.setup.ts` å°è¯•æ³¨å…¥ polyfills
   - ä½† setup æ–‡ä»¶è¿è¡Œæ—¶ï¼Œ`whatwg-url`ã€`webidl-conversions` ç­‰ä¾èµ–æ¨¡å—**å·²ç»å¼€å§‹åŠ è½½**
   - è¿™äº›æ¨¡å—åœ¨åˆå§‹åŒ–æ—¶å°±è®¿é—®äº† `TextEncoder` ç­‰å…¨å±€å¯¹è±¡
   - å¯¼è‡´å³ä½¿åç»­æ³¨å…¥ polyfill ä¹Ÿæ— æ³•ç”Ÿæ•ˆ

3. **å¤šæ¬¡å°è¯•å¤±è´¥**
   - å°è¯• 1ï¼šæ¡ä»¶åˆ¤æ–­ + èµ‹å€¼ â†’ æ—¶åºå¤ªæ™šï¼Œæ— æ•ˆ
   - å°è¯• 2ï¼š`Object.assign` å¼ºåˆ¶è¦†ç›– â†’ ä¾ç„¶æ—¶åºé—®é¢˜ï¼Œæ— æ•ˆ
   - æ ¹æœ¬åŸå› ï¼šæ‰‹åŠ¨ polyfill æ–¹æ¡ˆæ— æ³•è§£å†³æ¨¡å—åŠ è½½é¡ºåºé—®é¢˜

### æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ happy-dom

**ä¸ºä»€ä¹ˆé€‰æ‹© happy-domï¼š**
- âœ… å¯¹ Node.js ç¯å¢ƒå…¼å®¹æ€§æ›´å¥½ï¼Œ**æ— éœ€ä»»ä½• polyfills**
- âœ… æ›´è½»é‡ã€æ›´å¿«ï¼ˆå¯åŠ¨é€Ÿåº¦æ›´å¿«ï¼‰
- âœ… æ›´ç¨³å®šï¼ˆæ—  jsdom çš„å¤æ‚ä¾èµ–é“¾ï¼‰
- âœ… ç¬¦åˆ KISS åŸåˆ™ï¼šé…ç½®æ›´ç®€æ´

**å˜æ›´æ–‡ä»¶ï¼š**

1. **`package.json`** - æ·»åŠ ä¾èµ–
   ```json
   {
     "devDependencies": {
       "happy-dom": "^19.0.2",
       ...
     }
   }
   ```

2. **`vitest.config.ts`** - åˆ‡æ¢æµ‹è¯•ç¯å¢ƒ
   ```diff
   export default defineConfig({
     test: {
   -   environment: 'jsdom',
   -   setupFiles: ['./vitest.setup.ts'],
   +   environment: 'happy-dom',
       globals: true,
     },
     ...
   });
   ```

3. **`vitest.setup.ts`** - ä¸å†éœ€è¦ï¼ˆå¯åˆ é™¤æˆ–ä¿ç•™å¤‡ç”¨ï¼‰

### éªŒè¯ç»“æœ

**æœ¬åœ°æµ‹è¯•ï¼š**
```bash
npm run test -- --run

âœ“ tests/lib/scheduler/compute.test.ts  (4 tests) 6ms
âœ“ tests/ui/start-input-today.test.tsx  (1 test) 192ms
âœ“ tests/ui/pure-input-blur-commit-today.test.tsx  (2 tests) 373ms
âœ“ tests/ui/loose-time-templates.test.tsx  (1 test) 173ms
âœ“ tests/ui/start-input-templates.test.tsx  (1 test) 158ms
âœ“ tests/ui/wake-start-input-templates.test.tsx  (1 test) 163ms
âœ“ tests/ui/loose-time-today.test.tsx  (1 test) 158ms
âœ“ tests/smoke.test.ts  (1 test) 3ms
âœ“ tests/ui/wake-start-input-today.test.tsx  (1 test) 147ms

Test Files  9 passed (9)
     Tests  13 passed (13)
  Duration  4.23s
```

**CI æ„å»ºï¼š**
```
âœ“ Type Check (tsc)
âœ“ Unit Tests (Vitest)
âœ“ Build (Next.js)

Status: completed success
Duration: 1m10s
```

### æŠ€æœ¯å¯¹æ¯”ï¼šjsdom vs happy-dom

| ç‰¹æ€§ | jsdom | happy-dom |
|------|-------|-----------|
| Node.js å…¼å®¹æ€§ | éœ€è¦æ‰‹åŠ¨ polyfills | åŸç”Ÿå…¼å®¹ï¼Œæ— éœ€ polyfills |
| å¯åŠ¨é€Ÿåº¦ | è¾ƒæ…¢ï¼ˆå¤æ‚ä¾èµ–é“¾ï¼‰ | å¿«é€Ÿï¼ˆè½»é‡å®ç°ï¼‰ |
| å†…å­˜å ç”¨ | è¾ƒé«˜ | è¾ƒä½ |
| Web API è¦†ç›– | å…¨é¢ï¼ˆæ¥è¿‘çœŸå®æµè§ˆå™¨ï¼‰ | è¶³å¤Ÿæµ‹è¯•ä½¿ç”¨ |
| ç»´æŠ¤æˆæœ¬ | é«˜ï¼ˆéœ€å¤„ç† polyfillï¼‰ | ä½ï¼ˆå¼€ç®±å³ç”¨ï¼‰ |
| é€‚ç”¨åœºæ™¯ | éœ€è¦å®Œæ•´æµè§ˆå™¨ç¯å¢ƒæ¨¡æ‹Ÿ | å•å…ƒ/é›†æˆæµ‹è¯•ï¼ˆæ¨èï¼‰ |

### éµå¾ªçš„è®¾è®¡åŸåˆ™

1. **KISS (Keep It Simple, Stupid)**
   - ä»å¤æ‚çš„ polyfill æ–¹æ¡ˆåˆ‡æ¢åˆ°å¼€ç®±å³ç”¨çš„ happy-dom
   - ç§»é™¤äº† `vitest.setup.ts` çš„é…ç½®å¤æ‚åº¦

2. **YAGNI (You Aren't Gonna Need It)**
   - ä¸éœ€è¦å®Œæ•´çš„æµè§ˆå™¨ç¯å¢ƒæ¨¡æ‹Ÿï¼ˆjsdom æä¾›çš„ï¼‰
   - åªéœ€è¦è¶³å¤Ÿçš„ DOM API æ¥è¿è¡Œæµ‹è¯•

3. **æ€§èƒ½ä¼˜å…ˆ**
   - happy-dom å¯åŠ¨æ›´å¿«ï¼Œæµ‹è¯•æ‰§è¡Œæ›´å¿«
   - å‡å°‘ CI è¿è¡Œæ—¶é—´

### ç›¸å…³æäº¤

- `80e38eb` - feat(today): å•å…ƒæ ¼ç‚¹å‡»å³èšç„¦ï¼ˆè¾“å…¥æ¡†ä¿®å¤ï¼‰
- `4a077ae` - fix(input/start): å…è®¸ç¼–è¾‘"å¼€å§‹"åˆ—ï¼ˆéå—æ§ç»„ä»¶ï¼‰
- `[commit]` - fix(test): æ·»åŠ  jsdom polyfillsï¼ˆå¤±è´¥å°è¯•ï¼‰
- `a375b03` - fix(test): æ”¹è¿› jsdom polyfills ä½¿ç”¨ Object.assignï¼ˆä¾ç„¶å¤±è´¥ï¼‰
- `a3c166a` - fix(test): ä½¿ç”¨ happy-dom æ›¿ä»£ jsdomï¼ˆæœ€ç»ˆæˆåŠŸï¼‰âœ…

### åç»­å»ºè®®

1. âœ… å·²æ›´æ–° `AGENTS.md` æµ‹è¯•è§„èŒƒç« èŠ‚ï¼Œè¯´æ˜ä½¿ç”¨ happy-dom
2. âœ… CI é…ç½®æ— éœ€ä¿®æ”¹ï¼ˆ`.github/workflows/ci.yml`ï¼‰
3. ğŸ”„ å¯è€ƒè™‘åˆ é™¤ `vitest.setup.ts`ï¼ˆå·²ä¸å†ä½¿ç”¨ï¼‰
4. ğŸ“š å›¢é˜Ÿæˆå‘˜åº”äº†è§£ï¼šæœ¬é¡¹ç›®æµ‹è¯•ç¯å¢ƒä½¿ç”¨ happy-domï¼Œè€Œé jsdom
